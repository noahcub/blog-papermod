<!DOCTYPE html>
<html lang="en" dir="auto" data-theme="auto">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="noindex, nofollow">
<title>LineageOS y SafetyNet | Las notas de Noah</title>
<meta name="keywords" content="Smartphone">
<meta name="description" content="Configurar SafetyNet en LineageOS para activar el pago por NFC">
<meta name="author" content="">
<link rel="canonical" href="http://localhost:1313/posts/lineageos/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.cc6ab8f5faa8dc572f6069a132a436924276a646309355c961678b4646b2099f.css" integrity="sha256-zGq49fqo3FcvYGmhMqQ2kkJ2pkYwk1XJYWeLRkayCZ8=" rel="preload stylesheet" as="style">
<link rel="icon" href="http://localhost:1313/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="http://localhost:1313/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="http://localhost:1313/favicon-32x32.png">
<link rel="apple-touch-icon" href="http://localhost:1313/apple-touch-icon.png">
<link rel="mask-icon" href="http://localhost:1313/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="http://localhost:1313/posts/lineageos/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
                color-scheme: dark;
            }

            .list {
                background: var(--theme);
            }

            .toc {
                background: var(--entry);
            }
        }

        @media (prefers-color-scheme: light) {
            .list::-webkit-scrollbar-thumb {
                border-color: var(--code-bg);
            }
        }

    </style>
</noscript>
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.querySelector("html").dataset.theme = 'dark';
    } else if (localStorage.getItem("pref-theme") === "light") {
       document.querySelector("html").dataset.theme = 'light';
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.querySelector("html").dataset.theme = 'dark';
    } else {
        document.querySelector("html").dataset.theme = 'light';
    }

</script>
</head>
<body id="top">
    <header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="http://localhost:1313/" accesskey="h" title="Las notas de Noah (Alt + H)">Las notas de Noah</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)" aria-label="Toggle theme">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="http://localhost:1313/search/" title="Buscar (Alt &#43; /)" accesskey=/>
                    <span>Buscar</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/posts/" title="Publicaciones">
                    <span>Publicaciones</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/archives/" title="Archivo">
                    <span>Archivo</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/categories/" title="Categorías">
                    <span>Categorías</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/tags/" title="Etiquetas">
                    <span>Etiquetas</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    
    <h1 class="post-title entry-hint-parent">
      LineageOS y SafetyNet
    </h1>
    <div class="post-description">
      Configurar SafetyNet en LineageOS para activar el pago por NFC
    </div>
    <div class="post-meta"><span title='2023-09-25 16:00:00 +0100 +0100'>September 25, 2023</span>

</div>
  </header> <div class="toc">
    <details >
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#habilitar-el-safetynet-en-el-m%c3%b3vil-con-rom-personalizada" aria-label="Habilitar el safetynet en el móvil con ROM personalizada">Habilitar el safetynet en el móvil con ROM personalizada</a>
                </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><h2 id="habilitar-el-safetynet-en-el-móvil-con-rom-personalizada">Habilitar el safetynet en el móvil con ROM personalizada<a hidden class="anchor" aria-hidden="true" href="#habilitar-el-safetynet-en-el-móvil-con-rom-personalizada">#</a></h2>
<p><strong>ROM personalizada LINEAGEOS</strong><br>
Cuando nuestro teléfono ha llegado al fin de su vida útil en lo que se refiere a actualizaciones de seguridad, he decidido emplear una ROM personalizada que nos permite tener nuestro sistema actualizado y operativo.
Entre las que he probado están <a href="https://get.pixelexperience.org/">Pixel Experience</a> y <a href="https://lineageos.org/">LineageOS</a> entre otras.</p>
<p>Al final me he decido por LineageOS ya que me da mucha confianza.</p>
<p>Al usar estas ROM se genera un problema secundario, mi aplicación de pagos a través de NFC dice que el sistema tiene una ROM personalizada y por seguridad no permite realizar el pago.</p>
<p>Tenemos varias soluciones:</p>
<p>1.- Instalar MAGISK con un módulo de safetynet. Tal vez, si probara hoy me funcione, pero la segunda opción han sido 5 minutos y me ha funcionado a la primera.</p>
<p>2.- Modificar el fichero  <strong>/system/build.prop</strong> del teléfono móvil.</p>
<p>He optado por esta segunda opción porque en su día lo intenté con MAGISK y no lo hice funcionar, desconociendo el por qué.</p>
<p>La esencia consiste en modificar las siguientes líneas del fichero <strong>/system/build.prop</strong> y cambiar el valor:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ro.secure<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span> sustituirlos por ro.secure<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>ro.debuggable<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span> sustituirlos por ro.debuggable<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>
</span></span></code></pre></div><p>Para hacer este cambio tenemos que acceder al móvil por adb, que debe estar correctamente instalado en nuestro ordenador.</p>
<p>Habilitamos las opciones de desarrollador en el móvil:<br>
Accedemos a Información del teléfono &mdash;&gt; Número de compilación (pulsamos 5 veces)</p>
<p>Después:<br>
Sistema &mdash;&gt; <strong>Opciones de desarrollador</strong></p>
<p>Activamos <strong>Depuración por USB</strong> y <strong>Depuración como Superusuario</strong>.</p>
<p>Conectamos el teléfono al ordenador y activamos <strong>Transferencia de Archivos</strong> en lugar de <strong>Solo carga</strong>.</p>
<p>Ahora nos vamos a la terminal de nuestro ordenador y testeamos que detecta el teléfono:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#f92672">[</span>noah@envy ~<span style="color:#f92672">]</span>$ 
</span></span><span style="display:flex;"><span>╰─ adb devices
</span></span><span style="display:flex;"><span>* daemon not running; starting now at tcp:5037
</span></span><span style="display:flex;"><span>* daemon started successfully
</span></span><span style="display:flex;"><span>List of devices attached
</span></span><span style="display:flex;"><span>967fd02	device
</span></span></code></pre></div><p>Vemos que detectamos el teléfono, procedemos con el cambio:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#f92672">[</span>noah@envy ~<span style="color:#f92672">]</span>$ 
</span></span><span style="display:flex;"><span>╰─ adb root   
</span></span><span style="display:flex;"><span>restarting adbd as root
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>noah@envy ~<span style="color:#f92672">]</span>$ 
</span></span><span style="display:flex;"><span>╰─ adb remount 
</span></span><span style="display:flex;"><span>remount succeeded
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>noah@envy ~<span style="color:#f92672">]</span>$ 
</span></span><span style="display:flex;"><span>╰─ adb pull /system/build.prop .         
</span></span><span style="display:flex;"><span>/system/build.prop: <span style="color:#ae81ff">1</span> file pulled, <span style="color:#ae81ff">0</span> skipped. 0.9 MB/s <span style="color:#f92672">(</span><span style="color:#ae81ff">7671</span> bytes in 0.008s<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>noah@envy ~<span style="color:#f92672">]</span>$ 
</span></span><span style="display:flex;"><span>╰─ 
</span></span></code></pre></div><p>Ya tenemos el fichero build.prop y ahora vamos a modificar las dos líneas que nos interesan. El comando <strong>sed</strong> nos permite sustituir una cadena de texto por otra:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sed -i <span style="color:#e6db74">&#34;s/ro.secure=0/ro.secure=1/&#34;</span> build.prop
</span></span><span style="display:flex;"><span>sed -i <span style="color:#e6db74">&#34;s/ro.debuggable=1/ro.debuggable=0/&#34;</span> build.prop
</span></span></code></pre></div><p>Volvemos a subir el fichero al teléfono móvil:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> adb push build.prop /system/build.prop
</span></span></code></pre></div><p>Y listo, reiniciamos el teléfono móvil y ya podemos instalar nuestra aplicación de pagos a través del NFC y debería funcionar.</p>
<p>Para simplificar el trabajo podemos hacer un pequeño script que lo haga todo a la primera:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e">#!/bin/bash
</span></span></span><span style="display:flex;"><span>adb root
</span></span><span style="display:flex;"><span>adb remount
</span></span><span style="display:flex;"><span>adb pull /system/build.prop .
</span></span><span style="display:flex;"><span>sed -i <span style="color:#e6db74">&#34;s/ro.secure=0/ro.secure=1/&#34;</span> build.prop
</span></span><span style="display:flex;"><span>sed -i <span style="color:#e6db74">&#34;s/ro.debuggable=1/ro.debuggable=0/&#34;</span> build.prop
</span></span><span style="display:flex;"><span>adb push build.prop /system/build.prop
</span></span><span style="display:flex;"><span>rm build.prop
</span></span></code></pre></div><p>LineageOS hace actualizaciones semanales de la ROM. Cada vez que actualicemos tenemos que ejecutar nuestro pequeño script, activando las opciones de desarrollador, etc. por eso he decidido hacer actualizaciones mensuales mas o menos para no tener que estar pendiente de esto.</p>
<hr>
<p>Fuentes:</p>
<p>Modificar fichero build.prop<br>
<a href="https://github.com/OmarAhmed-A/MakeLineageOSSecure">https://github.com/OmarAhmed-A/MakeLineageOSSecure</a><br>
<a href="https://forum.xda-developers.com/t/safetynet-on-lineageos-20-microg.4558065/">https://forum.xda-developers.com/t/safetynet-on-lineageos-20-microg.4558065/</a></p>
<p>Magisk<br>
<a href="https://topjohnwu.github.io/Magisk/install.html">https://topjohnwu.github.io/Magisk/install.html</a><br>
<a href="https://community.fxtec.com/topic/2537-magisk-install-step-by-step-root/">https://community.fxtec.com/topic/2537-magisk-install-step-by-step-root/</a><br>
<a href="https://telegra.ph/Instalar-Magisk-v24-en-nuestra-ROM--Install-Magisk-on-our-ROM-03-11">https://telegra.ph/Instalar-Magisk-v24-en-nuestra-ROM&ndash;Install-Magisk-on-our-ROM-03-11</a></p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="http://localhost:1313/tags/smartphone/">Smartphone</a></li>
    </ul>
  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2026 <a href="http://localhost:1313/">Las notas de Noah</a></span> · 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu');
    if (menu) {
        
        const scrollPosition = localStorage.getItem("menu-scroll-position");
        if (scrollPosition) {
            menu.scrollLeft = parseInt(scrollPosition, 10);
        }
        
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        const html = document.querySelector("html");
        if (html.dataset.theme === "dark") {
            html.dataset.theme = 'light';
            localStorage.setItem("pref-theme", 'light');
        } else {
            html.dataset.theme = 'dark';
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
